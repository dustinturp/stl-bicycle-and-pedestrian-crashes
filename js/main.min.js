"use strict";function showBikeMap(){L.mapbox.accessToken="pk.eyJ1IjoiY29uZmx1ZW5jZWNpdHkiLCJhIjoiU05ETHk4VSJ9.8U46aM9pUowsCfgMsbidgg";var e=L.mapbox.tileLayer("confluencecity.kpmg98a4");e.on("ready",function(){bike_ped_map=L.mapbox.map("map",e.getTileJSON()),bikeFeatureLayer=L.mapbox.featureLayer().setFilter(function(e){return e.properties["marker-color"]=bike_colors[levels[e.properties.PERSONAL_INJ_LEVEL]],e.properties["marker-size"]="small",e.properties["marker-type"]="point",e.properties.CRASH_SEGMENT="Bicycle",e.properties.YEAR=e.properties.ACCIDENT_DATE.substring(0,4),e}).addTo(bike_ped_map),bikeFeatureLayer.loadURL("data/2013_and_2014_bike_crashes_geo.json?v=5"),bikeFeatureLayer.on("ready",function(){which.bicycle=!0,controlFeatureLayer(),display_update()}),pedFeatureLayer=L.mapbox.featureLayer().setFilter(function(e){return e.properties["marker-color"]=ped_colors[levels[e.properties.PERSONAL_INJ_LEVEL]],e.properties["marker-size"]="small",e.properties["marker-type"]="point",e.properties.CRASH_SEGMENT="Pedestrian",e.properties.YEAR=e.properties.ACCIDENT_DATE.substring(0,4),e}).addTo(bike_ped_map),pedFeatureLayer.loadURL("data/2013_and_2014_pedestrian_crashes_geo.json?v=5"),pedFeatureLayer.on("ready",function(){which.pedestrian=!0,controlFeatureLayer(),display_update()})}),e.on("error",function(e){})}function controlFeatureLayer(){if(1!=filters_written){var e=document.getElementById("filters"),r=["1","2","3","4","5","6"],t=["Fatal","Disabling Injury","Evident Injury (Not Disabling)","Probably Injury (Not Apparent)","None Apparent","Unknown"],n=["bicycle","pedestrian"],a=["Bicycle","Pedestrian"],i=["2013","2014"],p=["2013","2014"],o=e.appendChild(document.createElement("h2"));o.innerHTML="Types";for(var d=0;d<n.length;d++){var c=e.appendChild(document.createElement("div")),s=c.appendChild(document.createElement("input")),l=c.appendChild(document.createElement("label"));s.type="checkbox",s.id=n[d],s.checked=!0,l.innerHTML=a[d],l.setAttribute("for",n[d]),s.addEventListener("change",type_display_update),type_checkboxes.push(s)}var u=e.appendChild(document.createElement("h2"));u.innerHTML="Injury Levels";for(var d=0;d<r.length;d++){var c=e.appendChild(document.createElement("div")),s=c.appendChild(document.createElement("input")),l=c.appendChild(document.createElement("label"));s.type="checkbox",s.id=r[d],s.checked=!0,l.innerHTML=t[d],l.setAttribute("for",r[d]),s.addEventListener("change",display_update),checkboxes.push(s)}var y=e.appendChild(document.createElement("h2"));y.innerHTML="Years";for(var d=0;d<i.length;d++){var c=e.appendChild(document.createElement("div")),s=c.appendChild(document.createElement("input")),l=c.appendChild(document.createElement("label"));s.type="checkbox",s.id=i[d],s.checked=!0,l.innerHTML=p[d],l.setAttribute("for",i[d]),s.addEventListener("change",display_update),checkboxes.push(s)}filters_written=!0,display_update(checkboxes)}}function type_display_update(){for(var e={},r=0;r<type_checkboxes.length;r++)type_checkboxes[r].checked&&(e[type_checkboxes[r].id]=!0);"undefined"==typeof e.bicycle&&"undefined"!=typeof which.bicycle?(delete which.bicycle,bike_ped_map.removeLayer(bikeFeatureLayer)):"undefined"!=typeof e.bicycle&&"undefined"==typeof which.bicycle&&(which.bicycle=!0,bikeFeatureLayer.addTo(bike_ped_map)),"undefined"==typeof e.pedestrian&&"undefined"!=typeof which.pedestrian?(delete which.pedestrian,bike_ped_map.removeLayer(pedFeatureLayer)):"undefined"!=typeof e.pedestrian&&"undefined"==typeof which.pedestrian&&(which.pedestrian=!0,pedFeatureLayer.addTo(bike_ped_map))}function display_update(){for(var e={},r=0;r<checkboxes.length;r++)checkboxes[r].checked&&(e[checkboxes[r].id]=!0);bike_ped_map.eachLayer(function(r){"undefined"==typeof r._geojson||"undefined"!=typeof r._geojson.id&&"confluencecity.kpmg98a4"==r._geojson.id||(r.setFilter(function(r){return r.properties.PERSONAL_INJ_LEVEL in e&&r.properties.YEAR in e}),r.eachLayer(function(e){var r=["Fatal","Disabling Injury","Evident Injury (Not Disabling)","Probably Injury (Not Apparent)","None Apparent","Unknown"];if(0==e.feature.properties.PERSONAL_INJ_LEVEL)t=7;else var t=e.feature.properties.PERSONAL_INJ_LEVEL-1;var n="<p>Crash Type: "+e.feature.properties.CRASH_SEGMENT+"<br />Crash Date: "+e.feature.properties.ACCIDENT_DATE+"<br />Injury Level: "+r[t]+"<br />Location: "+e.feature.properties.ON_LOCATION_STREET;"undefined"!=typeof e.feature.properties.AT_LOCATION_STREET&&(n+=" at "+e.feature.properties.AT_LOCATION_STREET),n+="</p>",e.bindPopup(n)}))})}$(document).ready(function(){showBikeMap()});var bike_ped_map=null,bike_ped_layers=new Array,ped_colors={unknown:"#FFF0F5",none:"#F49AC2",probably:"#CF71AF",evident:"#FF007F",disabling:"#872657",fatal:"#614051"},bike_colors={unknown:"#FFFFB2",none:"#FED976",probably:"#FEB24C",evident:"#FD8D3C",disabling:"#E31A1C",fatal:"#B10026"},levels=["none","fatal","disabling","evident","probably","none","unknown"],filters_written=!1,checkboxes=[],bikeFeatureLayer=null,pedFeatureLayer=null,type_checkboxes=[],which={};